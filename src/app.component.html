<div
  class="h-[100dvh] w-full relative flex flex-col items-center justify-center -translate-y-12 md:translate-y-0 p-2 md:p-4 overflow-hidden font-rajdhani">

  <!-- Neon Light from Above -->
  <div class="neon-light-above"></div>

  @if (view() === 'menu') {
  <main
    class="relative z-10 flex flex-col items-center animate-in fade-in zoom-in duration-700 text-center scale-90 md:scale-90 w-full max-w-lg mx-auto">
    <div class="mb-6 md:mb-8 relative scale-75 md:scale-100">
      <div class="absolute inset-0 -m-16 border border-orange-500/5 rounded-full animate-[spin_60s_linear_infinite]">
      </div>
      <header class="relative">
        <div class="flex items-center justify-center gap-4 mb-2">
          <span
            class="text-orange-500 font-orbitron text-[8px] md:text-[9px] tracking-[0.4em] md:tracking-[0.8em] uppercase animate-pulse">Neural
            Interface Alpha</span>
        </div>
        <h1 class="text-5xl sm:text-6xl md:text-8xl font-orbitron font-bold tracking-tighter mb-4 select-none">
          <span class="text-orange-600 drop-shadow-[0_0_20px_rgba(234,88,12,0.6)]">CYBER</span><span
            class="text-orange-500 drop-shadow-[0_0_15px_rgba(249,115,22,0.8)]">SUM</span>
        </h1>
      </header>
    </div>

    <div class="flex flex-col gap-4 items-center w-full px-4">
      <button (click)="startGame()"
        class="group relative w-full max-w-[280px] py-4 md:px-12 bg-black border border-orange-500/40 rounded-sm overflow-hidden transition-all hover:border-orange-500 hover:shadow-[0_0_40px_rgba(249,115,22,0.3)] active:scale-95 touch-manipulation">
        <div class="absolute inset-0 bg-orange-600/10 opacity-0 group-hover:opacity-100 transition-opacity"></div>
        <span
          class="relative font-orbitron text-orange-500 group-hover:text-orange-200 tracking-[0.3em] md:tracking-[0.5em] uppercase text-xs">Initialize
          Link</span>
      </button>

      <div class="flex items-center gap-3">
        <!-- Audio Toggle Button -->
        <button (click)="toggleAudio()" [title]="isMuted() ? 'Enable Audio' : 'Mute Audio'"
          class="group flex items-center gap-2 px-4 py-2 border border-orange-950/30 rounded-full hover:bg-orange-500/5 transition-all touch-manipulation">
          @if (isMuted()) {
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            class="text-orange-900 group-hover:text-orange-500">
            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
            <line x1="23" y1="9" x2="17" y2="15"></line>
            <line x1="17" y1="9" x2="23" y2="15"></line>
          </svg>
          } @else {
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            class="text-orange-900 group-hover:text-orange-500">
            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
            <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
          </svg>
          }
          <span class="text-[10px] font-orbitron tracking-widest text-orange-900 group-hover:text-orange-500 uppercase">
            {{ isMuted() ? 'Enable Sound' : 'Mute Sound' }}
          </span>
        </button>

        <!-- Fullscreen Button -->
        <button (click)="toggleFullscreen()"
          class="group flex items-center gap-2 px-4 py-2 border border-orange-950/30 rounded-full hover:bg-orange-500/5 transition-all touch-manipulation">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            class="text-orange-900 group-hover:text-orange-500">
            <path d="M8 3H5a2 2 0 0 0-2 2v3" />
            <path d="M21 8V5a2 2 0 0 0-2-2h-3" />
            <path d="M3 16v3a2 2 0 0 0 2 2h3" />
            <path d="M16 21h3a2 2 0 0 0 2-2v-3" />
          </svg>
          <span class="text-[10px] font-orbitron tracking-widest text-orange-900 group-hover:text-orange-500 uppercase">
            {{ isFullscreen() ? 'Exit Fullscreen' : 'Enable Immersion' }}
          </span>
        </button>
      </div>
    </div>
  </main>
  } @else {
  <div
    class="w-full max-w-2xl flex flex-col items-center justify-center animate-in fade-in duration-700 scale-[0.85] md:scale-95">

    <!-- Main Console Unit -->
    <div
      class="console-frame w-full flex flex-col justify-between p-4 md:p-6 relative overflow-hidden rounded-[2.5rem] border border-orange-900/30 bg-black/80 backdrop-blur-3xl neon-border min-h-0 shadow-[0_0_60px_rgba(0,0,0,0.8)]">


      <!-- Success Overlay -->

      <!-- Success Overlay -->
      @if (isWinner()) {
      <div class="win-overlay-crt rounded-[2.5rem] animate-in fade-in zoom-in duration-300"
        [class.opacity-0]="isTransitioning()" [class.duration-1000]="isTransitioning()"
        [class.transition-opacity]="isTransitioning()">
        <div class="w-full text-center flex flex-col items-center justify-center p-4 md:p-8">
          <div
            class="py-12 md:py-20 border-y border-orange-500/30 bg-orange-950/10 w-full flex flex-col items-center justify-center">
            <h2
              class="text-3xl sm:text-5xl md:text-8xl font-orbitron font-bold text-orange-500 mb-4 drop-shadow-[0_0_20px_#f97316] animate-pulse select-none">
              NEURAL_LINK</h2>
            <div class="flex flex-col items-center gap-2 opacity-80">
              <span class="text-orange-400 font-mono tracking-[0.6em] uppercase text-[11px]">{{ winMessage() }}</span>
              <div class="h-[2px] w-32 bg-gradient-to-r from-transparent via-orange-600 to-transparent"></div>
            </div>

            @if (showEventVideo()) {
            <div class="mt-6 md:mt-8 relative z-50 animate-in zoom-in slide-in-from-bottom-4 duration-700 delay-300">
              <div class="absolute -inset-4 bg-orange-500/10 blur-xl rounded-full animate-pulse"></div>
              <video
                class="relative w-48 md:w-64 rounded-lg border border-orange-500/40 shadow-[0_0_40px_rgba(234,88,12,0.3)] opacity-90 hover:opacity-100 transition-opacity"
                autoplay playsinline (ended)="onVideoEnded()" (error)="showEventVideo.set(false)">
                <source src="win-video.mp4" type="video/mp4">
              </video>
            </div>
            }
          </div>
        </div>
      </div>
      }

      <div class="scan-line-horizontal"></div>

      <!-- Top Header Stats -->
      <div class="relative z-10 flex justify-between items-start mb-2">
        <div class="flex flex-col">
          <div class="flex items-center gap-2 mb-1">
            <div class="w-2 h-2 rounded-full bg-orange-600 animate-pulse shadow-[0_0_10px_#ea580c]"></div>
            <span class="text-[9px] font-orbitron text-orange-800 tracking-[0.3em] uppercase">Sector Link</span>
          </div>
          <span class="text-xl font-orbitron font-bold text-orange-600">LINK_ID: {{ currentLevel() < 10 ? '0' : '' }}{{
              currentLevel() }}</span>
        </div>

        <div class="flex items-center gap-2">
          <!-- Audio Toggle Button -->
          <button (click)="toggleAudio()" [title]="isMuted() ? 'Enable Audio' : 'Mute Audio'"
            class="w-8 h-8 flex items-center justify-center bg-orange-950/20 border border-orange-900/50 rounded-lg hover:border-orange-500 transition-all text-orange-900 hover:text-orange-400 group relative">
            @if (isMuted()) {
            <!-- Muted Icon -->
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
              <line x1="23" y1="9" x2="17" y2="15"></line>
              <line x1="17" y1="9" x2="23" y2="15"></line>
            </svg>
            } @else {
            <!-- Audio On Icon -->
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
              <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
            </svg>
            }
          </button>

          <button (click)="toggleFullscreen()" title="Toggle Immersion"
            class="w-8 h-8 flex items-center justify-center bg-orange-950/20 border border-orange-900/50 rounded-lg hover:border-orange-500 transition-all text-orange-900 hover:text-orange-400 group relative">
            @if (isFullscreen()) {
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M4 14h6v6" />
              <path d="M20 10h-6V4" />
              <path d="M14 10l7-7" />
              <path d="M10 14l-7 7" />
            </svg>
            } @else {
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M8 3H5a2 2 0 0 0-2 2v3" />
              <path d="M21 8V5a2 2 0 0 0-2-2h-3" />
              <path d="M3 16v3a2 2 0 0 0 2 2h3" />
              <path d="M16 21h3a2 2 0 0 0 2-2v-3" />
            </svg>
            }
          </button>
          <button (click)="resetGame()" title="Reset Session"
            class="w-8 h-8 flex items-center justify-center bg-orange-950/20 border border-orange-900/50 rounded-lg hover:border-orange-500 transition-all text-orange-900 hover:text-orange-400 group">
            <svg class="group-hover:rotate-180 transition-transform duration-500" xmlns="http://www.w3.org/2000/svg"
              width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
              <path d="M3 3v5h5" />
            </svg>
          </button>
          <button (click)="returnToMenu()" title="Disconnect Link"
            class="w-8 h-8 flex items-center justify-center bg-orange-950/20 border border-orange-900/50 rounded-lg hover:border-orange-500 transition-all text-orange-900 hover:text-orange-400 group">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path>
              <line x1="12" y1="2" x2="12" y2="12"></line>
            </svg>
          </button>
        </div>
      </div>

      <!-- Central Target Core -->
      <div class="relative z-10 flex flex-col items-center mb-4">
        <div
          class="relative py-4 px-6 md:p-8 bg-orange-950/5 border border-orange-500/10 min-w-[200px] text-center rounded-[2.5rem] shadow-[inset_0_0_50px_rgba(0,0,0,1)] transition-all duration-500"
          [class.animate-overload]="isWinner()" [class.border-orange-500]="isWinner()">

          <div class="absolute inset-0 pointer-events-none overflow-hidden rounded-[2.5rem]">
            @for (p of targetParticles(); track p.id) {
            <div class="particle animate-particle" [class.particle-orange]="p.color === 'orange'"
              [class.particle-white]="p.color === 'white'" [style.left.%]="p.x" [style.top.%]="p.y"
              [style.width]="p.size" [style.height]="p.size" [style.--dx]="p.dx" [style.--dy]="p.dy"
              [style.--dur]="p.dur" [style.--del]="p.del">
            </div>
            }
          </div>

          <span
            class="text-[10px] text-orange-700 uppercase tracking-[0.5em] font-bold block mb-2 opacity-60">TARGET_SYSTEM</span>
          <span class="text-6xl md:text-8xl font-orbitron font-bold target-glow relative z-10 block"
            [class.led-glitching]="glitchingLed() === 'target'">{{ targetSum()
            }}</span>
        </div>
      </div>

      <!-- The Reels -->
      <div class="relative z-10 flex items-center justify-center gap-4 md:gap-8 mb-6"
        [class.led-glitching]="glitchingLed() === 'reel'">
        <app-reel [range]="numbers1()" [isWinning]="isWinner()" (onValueChange)="onReelChange($event, 1)"
          [reelId]="1"></app-reel>
        <div class="text-4xl font-orbitron font-bold text-orange-900/30">+</div>
        <app-reel [range]="numbers2()" [isWinning]="isWinner()" (onValueChange)="onReelChange($event, 2)"
          [reelId]="2"></app-reel>
      </div>

      <!-- DIAGNOSTIC DASHBOARD -->
      <div class="relative z-10 w-full flex justify-center">
        <div
          class="iron-chassis w-full max-lg p-4 md:p-6 min-h-[140px] flex flex-col items-center justify-center transition-all duration-500"
          [class.animate-overload]="isWinner()" [class.border-orange-500]="isWinner()">

          <div class="flex flex-col items-center animate-in zoom-in duration-300 w-full text-center">
            <div class="flex flex-col items-center">
              <span
                class="text-[9px] text-orange-800 uppercase tracking-[0.4em] mb-4 font-orbitron opacity-40">Predictive
                Output</span>
              <div class="relative group w-36 md:w-48">
                <div class="display-light-leak" [class.opacity-100]="isWinner()"></div>
                <div
                  class="crt-visor w-full h-20 md:h-28 flex items-center justify-center rounded-2xl transition-all border-orange-900/40"
                  [class.led-glitching]="glitchingLed() === 'display'">
                  <span class="text-5xl md-text-7xl font-orbitron font-bold fluo-number transition-all duration-200"
                    [class.animate-pulse]="gameState() === 'checking'"
                    [class.text-orange-300]="gameState() === 'checking'" [class.scale-110]="gameState() === 'checking'">
                    {{ (reel1Val() || 0) + (reel2Val() || 0) }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  }
</div>